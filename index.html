<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A Chama do CASTELO - Réveillon 2026</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Importação das fontes */
        @import url('https://fonts.googleapis.com/css2?family=Great+Vibes&family=Cinzel:wght@400;700&family=Montserrat:wght@300;400;600&display=swap');

        :root {
            --gold: #C5A572; /* Dourado Principal */
            --dark-gold: #9e7e4e; /* Dourado Secundário para títulos */
            --cream: #F9F4E8;
            --dark-text: #2c3e50; /* Azul escuro/Preto para texto */
            
            /* Fontes */
            --heading-font: 'Cinzel', serif; 
            --script-font: 'Great Vibes', cursive; 
            --body-font: 'Montserrat', sans-serif;
        }

        body, html {
            margin: 0;
            padding: 0;
            font-family: var(--body-font);
            background-color: var(--cream);
            color: var(--dark-text);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            max-width: 850px;
            margin: 40px auto;
            padding: 50px;
            border: 2px solid var(--gold);
            background-color: #fff; 
            background-image: linear-gradient(to bottom right, #fffcf5, #fff);
            box-shadow: 0 15px 40px rgba(0,0,0,0.08);
            position: relative;
        }

        /* Detalhes de canto */
        .container::before, .container::after {
            content: '';
            position: absolute;
            width: 80px;
            height: 80px;
            border: 2px solid var(--gold);
            pointer-events: none;
        }
        .container::before { top: 10px; left: 10px; border-right: none; border-bottom: none; }
        .container::after { bottom: 10px; right: 10px; border-left: none; border-top: none; }

        .header {
            text-align: center;
            margin-bottom: 50px;
        }
        
        .date {
            font-family: var(--heading-font);
            font-size: 1.5rem;
            color: var(--dark-gold);
            letter-spacing: 5px;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .brand-name {
            display: flex;
            flex-direction: column;
            align-items: center;
            line-height: 1;
            position: relative; /* Para posicionar o botão TTS */
        }

        .brand-part-1 {
            font-family: var(--script-font);
            font-size: 2.8rem;
            color: var(--dark-gold);
            margin-bottom: 0px;
            font-weight: 400;
        }

        .brand-part-2 {
            font-family: var(--heading-font);
            font-size: 3.5rem;
            color: var(--dark-text);
            text-transform: uppercase;
            font-weight: 700;
            letter-spacing: 6px;
            margin-top: -15px;
        }
        
        .subtitle {
            font-family: var(--heading-font);
            font-size: 1.2rem;
            color: var(--gold);
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-top: 15px;
            padding-bottom: 5px;
            display: inline-block;
        }
        
        .divider {
            height: 1px;
            width: 50%;
            background: var(--gold);
            margin: 30px auto;
            opacity: 0.5;
        }

        .menu-section {
            margin-bottom: 40px;
            text-align: center;
        }

        .menu-heading {
            font-family: var(--heading-font);
            font-size: 1.8rem;
            color: var(--dark-gold);
            text-transform: uppercase;
            margin-bottom: 25px;
            font-weight: 700;
            padding: 5px 0;
        }
        
        .menu-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }
        
        .course {
            margin-bottom: 25px;
        }

        .course-title {
            font-family: var(--heading-font);
            font-size: 1.4rem;
            color: var(--dark-text);
            font-weight: 700;
            border-bottom: 1px dashed var(--gold);
            padding-bottom: 5px;
            margin-bottom: 10px;
            display: inline-block;
        }

        .course-description {
            font-family: var(--body-font);
            font-size: 1rem;
            color: #555;
            font-weight: 400;
            line-height: 1.4;
            margin: 5px auto;
            max-width: 650px;
        }
        
        .amuse-bouche-list {
            list-style: none;
            padding: 0;
            text-align: center;
            font-family: var(--body-font);
            font-size: 1rem;
            color: #555;
        }
        
        .amuse-bouche-list li {
            margin-bottom: 5px;
            font-style: italic;
        }

        /* Secções de Eventos e Preços */
        .details-section {
            margin-top: 40px;
            padding: 30px;
            background-color: rgba(197, 165, 114, 0.1); 
            border: 1px solid rgba(197, 165, 114, 0.5);
            border-radius: 5px;
        }
        
        .details-heading {
            font-family: var(--heading-font);
            font-size: 1.6rem;
            color: var(--dark-gold);
            text-transform: uppercase;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .info-block {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .info-block strong {
            font-family: var(--heading-font);
            font-size: 1.1rem;
            color: var(--dark-text);
            display: block;
            margin-bottom: 5px;
        }
        
        .info-block p {
            font-family: var(--body-font);
            font-size: 0.95rem;
            margin: 0;
            color: #555;
        }
        
        .price-contact-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 30px;
            text-align: center;
        }
        
        .price-contact-grid .contact-item {
            font-family: var(--heading-font);
            font-size: 1.1rem;
            margin: 5px 0;
        }

        .price-item {
            font-family: var(--heading-font);
            font-size: 1.5rem;
            color: var(--gold);
            font-weight: 700;
        }

        .price-details {
            font-family: var(--body-font);
            font-size: 0.9rem;
            color: #777;
            margin-top: 5px;
        }

        .event-list {
            list-style: none;
            padding: 0;
            display: inline-block;
            text-align: left;
            margin-top: 15px;
        }
        
        .event-list li {
            font-family: var(--heading-font);
            margin-bottom: 8px;
            color: var(--dark-text);
        }
        
        .event-list li i {
            color: var(--gold);
            margin-right: 10px;
        }

        /* Botões LLM */
        .llm-button {
            background-color: var(--gold);
            color: white;
            border: none;
            padding: 10px 15px;
            margin-top: 15px;
            border-radius: 5px;
            cursor: pointer;
            font-family: var(--body-font);
            font-weight: 600;
            transition: background-color 0.3s ease, transform 0.1s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
        }

        .llm-button:hover {
            background-color: var(--dark-gold);
            transform: translateY(-1px);
        }
        
        .llm-button:active {
            transform: translateY(1px);
        }

        #tts-button {
            position: absolute;
            top: 5px;
            right: -10px;
            padding: 5px 10px;
            font-size: 0.8rem;
            background-color: var(--dark-text);
        }

        /* Caixa de Mensagem/Resultado */
        #result-box {
            margin-top: 20px;
            padding: 20px;
            background-color: var(--cream);
            border: 1px solid var(--gold);
            border-radius: 5px;
            text-align: left;
            font-size: 0.9rem;
            max-height: 300px;
            overflow-y: auto;
            display: none; /* Escondido por padrão */
        }
        
        #result-box strong {
            display: block;
            margin-bottom: 10px;
            color: var(--dark-gold);
            font-family: var(--heading-font);
        }
        
        #result-box p {
            margin-bottom: 15px;
            padding-bottom: 5px;
            border-bottom: 1px dashed rgba(0,0,0,0.1);
        }
        
        .loading {
            display: inline-block;
            width: 15px;
            height: 15px;
            border: 2px solid #fff;
            border-radius: 50%;
            border-top-color: var(--dark-text);
            animation: spin 1s ease-in-out infinite;
            margin-left: 8px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsividade */
        @media (max-width: 700px) {
            .container {
                padding: 30px 20px;
                margin: 20px auto;
            }
            .brand-part-1 { font-size: 2.2rem; }
            .brand-part-2 { font-size: 2.8rem; letter-spacing: 4px; }
            .date { font-size: 1.2rem; }
            .menu-heading { font-size: 1.5rem; }
            .course-title { font-size: 1.3rem; }
            .price-contact-grid {
                grid-template-columns: 1fr;
            }
            #tts-button {
                right: 5px;
                top: 50%;
                transform: translateY(-50%);
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <header class="header">
            <h4 class="date">RÉVEILLON 2026</h4>
            
            <div class="brand-name">
                <span class="brand-part-1">A chama do</span>
                <span class="brand-part-2">CASTELO</span>
                <button id="tts-button" class="llm-button" title="Ouvir o nome do restaurante">
                    <i class="fas fa-volume-up"></i>
                </button>
            </div>
            
            <div class="subtitle">Restaurante</div>
        </header>
        
        <div class="divider"></div>

        <!-- O JANTAR -->
        <section class="menu-section">
            <h3 class="menu-heading">O Menu de Gala</h3>
            
            <!-- Amuse Bouche -->
            <div class="course">
                <div class="course-title">Variedades de Amuse Bouche</div>
                <ul class="amuse-bouche-list">
                    <li>Salmão fumado, gambas, Ostra</li>
                    <li>Foie gras com doce de cebola</li>
                    <li>Rissoles de rabo de boi</li>
                </ul>
            </div>
            
            <!-- Sopa -->
            <div class="course">
                <div class="course-title">Sopa (Opções)</div>
                <div class="course-description">Canja de galinha do campo **ou** Creme de cogumelos selvagens</div>
            </div>

            <!-- Primeiro Prato (Peixe) -->
            <div class="course">
                <div class="course-title">Primeiro Prato</div>
                <div class="course-description">Filete de dourada no forno com fricassé de legumes frescos</div>
            </div>
            
            <!-- Segundo Prato (Carne) -->
            <div class="course">
                <div class="course-title">Segundo Prato</div>
                <div class="course-description">
                    Tábua de 4 carnes (Angus Argentina, porco preto, borrego) <br>
                    Grelhados na carvão com autêntico “gratin dauphinois”
                </div>
            </div>
            
            <!-- Queijos -->
            <div class="course">
                <div class="course-title">Queijos</div>
                <div class="course-description">Tábua de 5 queijos franceses, acompanhada de salada e doce de figo caseiro</div>
            </div>
            
            <!-- Sobremesas -->
            <div class="course">
                <div class="course-title">Sobremesas com Champagne</div>
                <div class="course-description">
                    Fonte de chocolate com frutos frescos da época, Bolos gelados (vários sabores) e Sobremesas francesas
                </div>
            </div>
        </section>

        <div class="divider"></div>
        
        <!-- Vinhos e Bebidas -->
        <section class="menu-section">
            <div class="course-title">Vinhos e Bebidas</div>
            <div class="course-description" style="font-style: normal; color: var(--dark-gold);">
                Monte das Servas e Abelharuco (Tinto, Branco e Rosé)<br>
                **Todas as bebidas incluídas**
            </div>
        </section>

        <div class="details-section">
            <h3 class="details-heading">Entretenimento & Celebração</h3>
            <p style="text-align: center; font-family: var(--heading-font); font-size: 1.1rem; color: var(--dark-text); margin-bottom: 20px;">
                Venha celebrar a nossa noite maravilhosa do dia 31 de dezembro de 2025!
            </p>
            
            <ul class="event-list">
                <li><i class="fas fa-music"></i> DJ Johnny (com pista de dança)</li>
                <li><i class="fas fa-star-of-life"></i> Espetáculo de Fogo de Artifício</li>
                <li><i class="fas fa-fire-alt"></i> Fogueira no exterior</li>
            </ul>
            
            <div style="text-align: center;">
                <button id="theme-button" class="llm-button">
                    ✨ Gerar Ideias de Tema/Decoração ✨
                </button>
            </div>

            <div id="result-box"></div>
        </div>
        
        <div class="price-contact-grid">
            <div class="info-block">
                <strong class="price-item">150 Euros / Pessoa</strong>
                <p class="price-details">Gratuito para crianças até 8 anos</p>
            </div>
            
            <div class="info-block" style="text-align: right;">
                <strong style="font-size: 1.2rem;">Reservas e Informações</strong>
                <p class="contact-item">Tel: 963 670 118</p>
                <p class="contact-item">16 rua da ConvençãoMini, Évoramonte</p>
            </div>
        </div>
        
        <div style="text-align: center; margin-top: 30px;">
             <i class="fas fa-handshake" style="color: var(--gold); font-size: 1.5rem;"></i>
        </div>

    </div>

    <script>
        // --- Gemini API Utilities ---

        const LLM_MODEL = 'gemini-2.5-flash-preview-09-2025';
        const TTS_MODEL = 'gemini-2.5-flash-preview-tts';
        const apiKey = ""; // API Key is provided by the environment

        /**
         * Generic fetch utility with exponential backoff for the Gemini API.
         */
        async function fetchWithBackoff(url, options, maxRetries = 5) {
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (response.status !== 429) { // Not a rate limit error
                        return response;
                    }
                    console.warn(`Rate limit exceeded (429). Retrying in ${2 ** i}s...`);
                    await new Promise(resolve => setTimeout(resolve, (2 ** i) * 1000));
                } catch (error) {
                    console.error('Fetch error:', error);
                    // For network errors, wait before retrying
                    await new Promise(resolve => setTimeout(resolve, (2 ** i) * 1000));
                }
            }
            throw new Error("Failed to fetch from Gemini API after multiple retries.");
        }

        // --- TTS Utility Functions ---

        function base64ToArrayBuffer(base64) {
            const binaryString = atob(base64);
            const len = binaryString.length;
            const bytes = new Uint8Array(len);
            for (let i = 0; i < len; i++) {
                bytes[i] = binaryString.charCodeAt(i);
            }
            return bytes.buffer;
        }

        function pcmToWav(pcm16, sampleRate) {
            const numChannels = 1;
            const bytesPerSample = 2; // Int16
            const blockAlign = numChannels * bytesPerSample;
            const byteRate = sampleRate * blockAlign;

            const buffer = new ArrayBuffer(44 + pcm16.byteLength);
            const view = new DataView(buffer);

            const writeString = (view, offset, string) => {
                for (let i = 0; i < string.length; i++) {
                    view.setUint8(offset + i, string.charCodeAt(i));
                }
            };

            // RIFF identifier 'RIFF'
            writeString(view, 0, 'RIFF');
            // RIFF chunk length
            view.setUint32(4, 36 + pcm16.byteLength, true);
            // WAVE form type 'WAVE'
            writeString(view, 8, 'WAVE');
            // format chunk identifier 'fmt '
            writeString(view, 12, 'fmt ');
            // format chunk length
            view.setUint32(16, 16, true);
            // sample format (raw PCM)
            view.setUint16(20, 1, true);
            // channel count
            view.setUint16(22, numChannels, true);
            // sample rate
            view.setUint32(24, sampleRate, true);
            // byte rate (sample rate * block align)
            view.setUint32(28, byteRate, true);
            // block align (channel count * bytes per sample)
            view.setUint16(32, blockAlign, true);
            // bits per sample
            view.setUint16(34, 16, true);
            // data chunk identifier 'data'
            writeString(view, 36, 'data');
            // data chunk length
            view.setUint32(40, pcm16.byteLength, true);

            // Write the PCM data
            let offset = 44;
            for (let i = 0; i < pcm16.length; i++, offset += 2) {
                view.setInt16(offset, pcm16[i], true);
            }

            return new Blob([buffer], { type: 'audio/wav' });
        }

        // --- Feature 1: TTS Reading of Brand Name ---

        const ttsButton = document.getElementById('tts-button');

        async function generateAndPlayTTS(text, voiceName = "Kore") {
            ttsButton.disabled = true;
            ttsButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';

            try {
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${TTS_MODEL}:generateContent?key=${apiKey}`;
                
                // Note: Using pt-BR as the closest available language for Portuguese.
                const systemPrompt = `You are a formal Portuguese speaker. Say the following text in a clear, luxurious, and slightly majestic tone.`;

                const payload = {
                    contents: [{ parts: [{ text: text }] }],
                    systemInstruction: { parts: [{ text: systemPrompt }] },
                    generationConfig: {
                        responseModalities: ["AUDIO"],
                        speechConfig: {
                            voiceConfig: {
                                prebuiltVoiceConfig: { voiceName: voiceName }
                            }
                        }
                    },
                    model: TTS_MODEL
                };

                const response = await fetchWithBackoff(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                const part = result?.candidates?.[0]?.content?.parts?.[0];
                const audioData = part?.inlineData?.data;
                const mimeType = part?.inlineData?.mimeType;

                if (audioData && mimeType && mimeType.startsWith("audio/")) {
                    const rateMatch = mimeType.match(/rate=(\d+)/);
                    const sampleRate = rateMatch ? parseInt(rateMatch[1], 10) : 16000;
                    
                    const pcmData = base64ToArrayBuffer(audioData);
                    const pcm16 = new Int16Array(pcmData);
                    
                    const wavBlob = pcmToWav(pcm16, sampleRate);
                    const audioUrl = URL.createObjectURL(wavBlob);
                    
                    const audio = new Audio(audioUrl);
                    audio.play();
                    
                    audio.onended = () => {
                        ttsButton.innerHTML = '<i class="fas fa-volume-up"></i>';
                        ttsButton.disabled = false;
                        URL.revokeObjectURL(audioUrl);
                    };
                } else {
                    displayResult('Erro de TTS', 'Não foi possível gerar o áudio. Tente novamente mais tarde.', true);
                }

            } catch (error) {
                console.error('TTS API Error:', error);
                displayResult('Erro de TTS', 'Ocorreu um erro ao comunicar com a API.', true);
            } finally {
                // Ensure button resets even on error
                if (ttsButton.disabled) {
                    ttsButton.innerHTML = '<i class="fas fa-volume-up"></i>';
                    ttsButton.disabled = false;
                }
            }
        }

        ttsButton.addEventListener('click', () => {
            const textToSpeak = "A Chama do Castelo. Restaurante. Feliz Ano Novo 2026!";
            generateAndPlayTTS(textToSpeak, "Kore"); // Kore for a firm, formal voice
        });

        // --- Feature 2: Theme Generator ---

        const themeButton = document.getElementById('theme-button');
        const resultBox = document.getElementById('result-box');

        /**
         * Displays the result in the dedicated message box.
         * @param {string} title - The title of the message.
         * @param {string} content - The content (HTML or plain text).
         * @param {boolean} isError - Whether the message is an error.
         */
        function displayResult(title, content, isError = false) {
            resultBox.style.display = 'block';
            resultBox.innerHTML = `
                <strong style="color: ${isError ? 'red' : 'var(--dark-gold)'};">${title}</strong>
                ${content}
            `;
            resultBox.scrollTop = 0; // Scroll to top
        }

        async function generateThemeIdeas() {
            themeButton.disabled = true;
            themeButton.innerHTML = 'A gerar ideias... <span class="loading"></span>';
            resultBox.style.display = 'none';

            try {
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${LLM_MODEL}:generateContent?key=${apiKey}`;

                const systemPrompt = `Você é um planeador de eventos luxuosos com foco em temas medievais e de castelos. Você deve gerar 3 ideias de temas criativos e luxuosos para um jantar de gala de Ano Novo num restaurante chamado 'A Chama do CASTELO'. Para cada tema, forneça o Título do Tema, uma Breve Descrição e 2 Sugestões de Decoração específicas. O output deve ser formatado estritamente como JSON, usando a língua Portuguesa (Portugal).`;

                const userQuery = "Gerar 3 ideias de temas de gala de Réveillon para 'A Chama do CASTELO', focando em luxo e tema de castelo/medieval.";

                const payload = {
                    contents: [{ parts: [{ text: userQuery }] }],
                    systemInstruction: { parts: [{ text: systemPrompt }] },
                    generationConfig: {
                        responseMimeType: "application/json",
                        responseSchema: {
                            type: "ARRAY",
                            items: {
                                type: "OBJECT",
                                properties: {
                                    "Título do Tema": { "type": "STRING" },
                                    "Descrição": { "type": "STRING" },
                                    "Sugestões de Decoração": { 
                                        "type": "ARRAY",
                                        "items": { "type": "STRING" }
                                    }
                                }
                            }
                        }
                    }
                };

                const response = await fetchWithBackoff(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                
                const jsonText = result.candidates?.[0]?.content?.parts?.[0]?.text;

                if (!jsonText) {
                    throw new Error("Resposta da API vazia ou inesperada.");
                }

                const themes = JSON.parse(jsonText);
                
                let htmlContent = '';
                themes.forEach((theme, index) => {
                    htmlContent += `
                        <p>
                            <strong>${index + 1}. ${theme["Título do Tema"]}</strong><br>
                            <em>${theme["Descrição"]}</em><br>
                            <span style="display: block; margin-top: 5px; color: #777;">Decoração: ${theme["Sugestões de Decoração"].join('; ')}</span>
                        </p>
                    `;
                });

                displayResult('✨ 3 Ideias de Temas de Gala Geradas', htmlContent);

            } catch (error) {
                console.error('Theme Generator Error:', error);
                displayResult('Erro de Geração', `Ocorreu um erro ao gerar as ideias. (${error.message})`, true);
            } finally {
                themeButton.innerHTML = '✨ Gerar Ideias de Tema/Decoração ✨';
                themeButton.disabled = false;
            }
        }

        themeButton.addEventListener('click', generateThemeIdeas);

    </script>

</body>
</html>
